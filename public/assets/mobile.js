(function(){var r=20;var x=0;var F=null;var t=null;var u=0;var k=0;var A=location.hash;var f="#_";var p=[];var m=0;var I;var z=false;var J="portrait";var C="landscape";window.iui={animOn:true,httpHeaders:{"X-Requested-With":"XMLHttpRequest"},showPage:function(L,K){if(L){if(t){t.removeAttribute("selected");q("blur",t);t=null}if(d(L,"dialog")){q("focus",L);y(L)}else{q("load",L);var M=F;q("blur",F);F=L;q("focus",L);if(M){if(K){q("unload",M)}setTimeout(c,0,M,L,K)}else{w(L,M)}}}},showPageById:function(L){var N=o(L);if(N){var M=p.indexOf(L);var K=M!=-1;if(K){p.splice(M)}iui.showPage(N,K)}},goBack:function(){p.pop();var K=p.pop();var L=o(K);iui.showPage(L,true)},showPageByHref:function(L,M,P,O,K){function N(Q){if(Q.readyState==4){var R=document.createElement("div");R.innerHTML=Q.responseText;q("beforeinsert",document.body,{fragment:R});if(O){D(O,R)}else{iui.insertPages(R)}if(K){setTimeout(K,1000,true)}}}iui.ajax(L,M,P,N)},ajax:function(M,L,Q,K){var O=new XMLHttpRequest();Q=Q?Q.toUpperCase():"GET";if(L&&Q=="GET"){M=M+"?"+iui.param(L)}O.open(Q,M,true);if(K){O.onreadystatechange=function(){K(O)}}var N=null;if(L&&Q!="GET"){O.setRequestHeader("Content-Type","application/x-www-form-urlencoded");N=iui.param(L)}for(var P in iui.httpHeaders){O.setRequestHeader(P,iui.httpHeaders[P])}O.send(N)},param:function(M){var L=[];for(var K in M){L[L.length]=encodeURIComponent(K)+"="+encodeURIComponent(M[K])}return L.join("&").replace(/%20/g,"+")},insertPages:function(Q){var L=Q.childNodes;var N;for(var M=0;M<L.length;++M){var P=L[M];if(P.nodeType==1){if(!P.id){P.id="__"+(++m)+"__"}var O=o(P.id);var K;if(O){O.parentNode.replaceChild(P,O);K=o(P.id)}else{K=document.body.appendChild(P)}q("afterinsert",document.body,{insertedNode:K});if(P.getAttribute("selected")=="true"||!N){N=P}--M}}if(N){iui.showPage(N)}},getSelectedPage:function(){for(var K=document.body.firstChild;K;K=K.nextSibling){if(K.nodeType==1&&K.getAttribute("selected")=="true"){return K}}},isNativeUrl:function(K){for(var L=0;L<iui.nativeUrlPatterns.length;L++){if(K.match(iui.nativeUrlPatterns[L])){return true}}return false},nativeUrlPatterns:[new RegExp("^http://maps.google.com/maps?"),new RegExp("^mailto:"),new RegExp("^tel:"),new RegExp("^http://www.youtube.com/watch\\?v="),new RegExp("^http://www.youtube.com/v/"),new RegExp("^javascript:"),],hasClass:function(K,L){var M=new RegExp("(^|\\s)"+L+"($|\\s)");return M.exec(K.getAttribute("class"))!=null},addClass:function(K,L){if(!iui.hasClass(K,L)){K.className+=" "+L}},removeClass:function(K,L){if(iui.hasClass(K,L)){var M=new RegExp("(\\s|^)"+L+"(\\s|$)");K.className=K.className.replace(M," ")}}};addEventListener("load",function(L){var M=iui.getSelectedPage();var K=E();if(M){iui.showPage(M)}if(K&&(K!=M)){iui.showPage(K)}setTimeout(s,0);if(typeof window.onorientationchange=="object"){window.onorientationchange=j;z=true;setTimeout(j,0)}setTimeout(h,0);I=setInterval(h,300)},false);addEventListener("unload",function(K){return},false);addEventListener("click",function(N){var M=a(N.target,"a");if(M){function K(){M.removeAttribute("selected")}if(M.href&&M.hash&&M.hash!="#"&&!M.target){M.setAttribute("selected","true");iui.showPage(o(M.hash.substr(1)));setTimeout(K,500)}else{if(M==o("backButton")){iui.goBack()}else{if(M.getAttribute("type")=="submit"){var L=a(M,"form");if(L.target=="_self"){L.submit();return}v(L)}else{if(M.getAttribute("type")=="cancel"){g(a(M,"form"))}else{if(M.target=="_replace"){M.setAttribute("selected","progress");iui.showPageByHref(M.href,null,"GET",M,K)}else{if(iui.isNativeUrl(M.href)){return}else{if(M.target=="_webapp"){location.href=M.href}else{if(!M.target){M.setAttribute("selected","progress");iui.showPageByHref(M.href,null,"GET",null,K)}else{return}}}}}}}}N.preventDefault()}},true);addEventListener("click",function(K){var L=a(K.target,"div");if(L&&d(L,"toggle")){L.setAttribute("toggled",L.getAttribute("toggled")!="true");K.preventDefault()}},true);function q(L,N,K){if(N){var M=document.createEvent("UIEvent");M.initEvent(L,false,false);if(K){for(i in K){M[i]=K[i]}}N.dispatchEvent(M)}}function E(){var L;var K=location.hash.match(/#_([^\?_]+)/);if(K){L=K[1]}if(L){L=o(L)}return L}function j(){var K=window.orientation;switch(K){case 0:G(J);break;case 90:case -90:G(C);break}}function h(){if(!z){if((window.innerWidth!=u)||(window.innerHeight!=k)){u=window.innerWidth;k=window.innerHeight;var L=(u<k)?J:C;G(L)}}if(location.hash!=A){var K=location.hash.substr(f.length);iui.showPageById(K)}}function G(K){document.body.setAttribute("orient",K);if(K==J){iui.removeClass(document.body,C);iui.addClass(document.body,J)}else{if(K==C){iui.removeClass(document.body,J);iui.addClass(document.body,C)}else{iui.removeClass(document.body,J);iui.removeClass(document.body,C)}}setTimeout(scrollTo,100,0,1)}function y(K){t=K;K.setAttribute("selected","true");if(d(K,"dialog")){B(K)}}function B(K){K.onsubmit=function(L){L.preventDefault();v(K)};K.onclick=function(L){if(L.target==K&&d(K,"dialog")){g(K)}}}function g(K){K.removeAttribute("selected")}function w(P,Q){if(!P.id){P.id="__"+(++m)+"__"}location.hash=A=f+P.id;p.push(P.id);var O=o("pageTitle");if(P.title){O.innerHTML=P.title}var L=P.getAttribute("ttlclass");O.className=L?L:"";if(P.localName.toLowerCase()=="form"&&!P.target){B(P)}var M=o("backButton");if(M){var K=o(p[p.length-2]);if(K&&!P.getAttribute("hideBackButton")){M.style.display="inline";M.innerHTML=K.title?K.title:"Back";var N=K.getAttribute("bbclass");M.className=(N)?"button "+N:"button"}else{M.style.display="none"}}}function c(O,N,L){var M=(L?O:N).getAttribute("axis");clearInterval(I);q("beforetransition",O,{out:true});q("beforetransition",N,{out:false});if(l()&&M!="y"){b(O,N,L,K)}else{e(O,N,L,M,K)}function K(){if(!d(N,"dialog")){O.removeAttribute("selected")}I=setInterval(h,300);setTimeout(w,0,N,O);O.removeEventListener("webkitTransitionEnd",K,false);q("aftertransition",O,{out:true});q("aftertransition",N,{out:false})}}function l(){return(iui.animOn)&&(typeof WebKitCSSMatrix=="object")}function e(Q,P,M,N,L){if(N=="y"){(M?Q:P).style.top="100%"}else{P.style.left="100%"}scrollTo(0,1);P.setAttribute("selected","true");q("selected",P);var O=100;K();var R=setInterval(K,x);function K(){O-=r;if(O<=0){O=0;clearInterval(R);L()}if(N=="y"){M?Q.style.top=(100-O)+"%":P.style.top=O+"%"}else{Q.style.left=(M?(100-O):(O-100))+"%";P.style.left=(M?-O:O)+"%"}}}function b(P,O,L,K){O.style.webkitTransitionDuration="0ms";var M="translateX("+(L?"-":"")+window.innerWidth+"px)";var N="translateX("+(L?"100%":"-100%")+")";O.style.webkitTransform=M;O.setAttribute("selected","true");q("selected",O);O.style.webkitTransitionDuration="";function Q(){P.style.webkitTransform=N;O.style.webkitTransform="translateX(0%)"}P.addEventListener("webkitTransitionEnd",K,false);setTimeout(Q,0)}function s(){var K=document.createElement("div");K.id="preloader";document.body.appendChild(K)}function v(L){iui.addClass(L,"progress");iui.showPageByHref(L.action,H(L),L.method||"GET",null,K);function K(){iui.removeClass(L,"progress")}}function H(M){function L(N){for(var O=0;O<N.length;++O){if(N[O].name){K[N[O].name]=N[O].value}}}var K={};L(M.getElementsByTagName("input"));L(M.getElementsByTagName("textarea"));L(M.getElementsByTagName("select"));L(M.getElementsByTagName("button"));return K}function a(L,K){while(L&&(L.nodeType!=1||L.localName.toLowerCase()!=K)){L=L.parentNode}return L}function d(K,L){return iui.hasClass(K,L)}function D(L,O){var N=L.parentNode;var M=L;while(N.parentNode!=document.body){N=N.parentNode;M=M.parentNode}N.removeChild(M);var K;while(O.firstChild){K=N.appendChild(O.firstChild);q("afterinsert",document.body,{insertedNode:K})}}function o(K){return document.getElementById(K)}function n(){console.log.apply(console,arguments)}})();$.WorldBank={};$.WorldBank.TheMap=function(){var b;var c;var l;var j;var h="undisbursed_percent";function n(){c=new google.maps.LatLng(40,14);if(navigator&&navigator.geolocation){navigator.geolocation.getCurrentPosition(e,g)}}function e(p){c=new google.maps.LatLng(p.coords.latitude,p.coords.longitude);if(b){b.panTo(c)}}function g(){}function k(){if(l==null||l!=b.getZoom()){l=b.getZoom();return true}else{return false}}function a(){b=new google.maps.Map(document.getElementById("map"),{center:c,mapTypeId:google.maps.MapTypeId.TERRAIN,zoom:4,streetViewControl:false,mapTypeControl:false,panControl:false,zoomControl:false,disableDefaultUI:true,maxZoom:6})}function f(){j=new $.WorldBank.CountryMarkersOverlay(b)}function m(){$("#MapContainer").bind("selected",d);$(window).resize(d);$("#view_undisbursed_loans").click(function(){$.WorldBank.Country.load($("#undisbursed_percent")[0])});$("#view_disbursed_loans").click(function(){$.WorldBank.Country.load($("#disbursed_percent")[0])})}function d(){google.maps.event.trigger(b,"resize")}$(document).ready(function(){$("#view_disbursed_loans").one("click",function(){h="disbursed_percent"});o.initialize();$("#MapContainer").one("aftertransition",function(){b.panTo(c)})});var o={initialize:function(){$("body").append('<script src="http://maps.google.com/maps/api/js?sensor=true&callback=$.WorldBank.TheMap.googleLoaded" type="text/javascript"><\/script>')},googleLoaded:function(){$(window).trigger("google_ready");n();a();$.WorldBank.Country.load($("#"+h)[0]);f();m()},redrawMarkers:function(){if(j){j.draw(true)}},getMap:function(){return b}};return o}();$.WorldBank.CountryMarkersOverlay=(function(){return function(c){var d=c;var f=$('<div class="country-markers"></div>');var a;var b=-1;var e=function(){if(d.getZoom()!=b){b=d.getZoom();return false}else{return true}};this.onAdd=function(){a=this.getProjection();var g=$(this.getPanes().overlayImage);g.append(f)};this.onRemove=function(){f.remove()};this.draw=function(m){if(!m&&e()){return}$(".country-marker").unbind("click");f.empty();var k=document.createDocumentFragment();var h=$.WorldBank.Country.all();for(var l=0;l<h.length;l++){var n=h[l];var g=a.fromLatLngToDivPixel(n.getLatLng());var j=n.getMarkerElement(g);k.appendChild(j)}f.append(k)};this.setCountries=function(g){countries=g};this.setMap(d)}})();$(window).one("google_ready",function(){$.WorldBank.CountryMarkersOverlay.prototype=new google.maps.OverlayView});$.WorldBank.Country=(function(){var a=[1,10,30,40,60,90,100];var b=[10,10,14,20,28,34,40];return function(g){var g;var j=$.WorldBank.TheMap.getMap();var e=this;var h=function(l){return'<img src="'+e.getMarkerImageUrl()+'" style="width: '+l+"px; height: "+l+'px;"/>'};var c=function(l){return'<div class="marker-overlay '+f()+" "+k()+'" style="left: 0; top: 0; width: '+l+"px; height: "+l+"px; line-height: "+l+'px;">'+e.getOverlayText()+"</div>"};var d=function(){return g.size_factor};var f=function(){return"zoom-"+j.getZoom()};var k=function(){return"size-"+Math.round(d()*3)};this.getMarkerElement=function(m){var o=d();if(o<0){o=0}var p=Math.round(a[j.getZoom()]*o+b[j.getZoom()]);var s=Math.round(p/2);var l=m.x-s;var r=m.y-s;var n=Math.round(1-o*100);var q=$('<div class="country-marker" style="left: '+l+"px; top: "+r+"px; width: "+p+"px; height: "+p+"px; z-index: "+n+'">'+h(p)+c(p)+"</div>");q.click(this.clicked);return q.get(0)};this.getMarkerImageUrl=function(){return g.marker_image_url};this.clicked=function(l){window.iui.showPageByHref(e.getLink())};this.getLatitude=function(){return g.latitude};this.getLongitude=function(){return g.longitude};this.getLatLng=function(){return new google.maps.LatLng(this.getLatitude(),this.getLongitude())};this.getId=function(){return g.id};this.getName=function(){return g.name};this.update=function(l){g=l};this.getLink=function(){return g.link};this.getOverlayText=function(){return g.overlay_text};this.data=g;$.WorldBank.Country.countries[g.name]=this}})();$.WorldBank.Country.countries=[];$.WorldBank.Country.all=function(){return this.countries};$.WorldBank.Country.create_or_update=function(b){if(b==null||b.error){return null}if(b instanceof Array){for(var a in b){$.WorldBank.Country.create_or_update(b[a])}}else{if(this.exists(b)){this.update(b)}else{this.create(b)}}};$.WorldBank.Country.create=function(a){var b=new $.WorldBank.Country(a);this.countries.push(b);return b};$.WorldBank.Country.update=function(a){var b=this.countries[a.name];b.update(a)};$.WorldBank.Country.exists=function(a){if(this.countries[a.name]){return true}else{return false}};$.WorldBank.Country.changeData=function(a){$.WorldBank.Country.create_or_update(a);$.WorldBank.TheMap.redrawMarkers();$("#Navigation div.option").not("#Navigation .option[selected]").click(function(){$.WorldBank.Country.load(this)})};$.WorldBank.Country.load=function(a){$("#Navigation div.option").unbind("click");$("#Navigation .option").removeAttr("selected");$(a).attr("selected","progress");var b="/country_data/"+a.id;if(localStorage[b]){this.changeData($.parseJSON(localStorage[b]));$(a).attr("selected",true)}else{$.get(b+".json",function(c){localStorage[b]=c;$.WorldBank.Country.changeData($.parseJSON(c));$(a).attr("selected",true)},"text")}};